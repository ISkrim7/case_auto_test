#!/usr/bin/env python# -*- coding:utf-8 -*-# @Time : 2024/6/6# @Author : cyq# @File : __init__.py# @Software: PyCharm# @Desc:from fastapi import Headerfrom utils import MyLogurufrom app.mapper.user import UserMapperfrom ..exception import AuthErrorLOG = MyLoguru().get_logger()class Authentication:    def __init__(self, isAdmin: bool = False):        self.isAdmin = isAdmin    async def __call__(self, token: str = Header(None)):        if not token:            raise AuthError("请先登录")        current_user_dict = await UserMapper.parse_token(token)        # 要求admin。但是是普通用户        if self.isAdmin is True and current_user_dict["isAdmin"] is False:            raise AuthError("无权操作")        current_user = await UserMapper.get_by_id(current_user_dict["id"], )        LOG.info(f"current user {current_user}")        return current_userfrom app.controller import file, statisticsfrom .project import project, db_config, module, push_config, aps_jobfrom .user import user, departmentfrom .ui import ui_case, ui_task, ui_step_group, ui_env, ui_method, ui_step, ui_varsfrom .interface import (interfaceCase, interfaceGlobal,                        interfaceApi, interfaceTask, interfaceResult, interfaceRecord, interfaceGroupApi)from .mock import mockApiRegisterRouterList = [    file.router,  # 改为 file.router    aps_job.router,  # 改为 aps_job.router    push_config.router,  # 改为 push_config.router    db_config.router,  # 改为 db_config.router    statistics.router,  # 改为 statistics.router    project.router,  # 改为 project.router    module.router,  # 改为 module.router    user.router,  # 改为 user.router    department.router,  # 改为 department.router    ui_case.router,  # 改为 ui_case.router    ui_env.router,  # 改为 ui_env.router    ui_method.router,  # 改为 ui_method.router    ui_step.router,  # 改为 ui_step.router    ui_task.router,  # 改为 ui_task.router    ui_step_group.router,  # 改为 ui_step_group.router    ui_vars.router,  # 改为 ui_vars.router    interfaceTask.router,  # 改为 interfaceTask.router    interfaceResult.router,  # 改为 interfaceResult.router    interfaceGlobal.router,  # 改为 interfaceGlobal.router    interfaceGroupApi.router,  # 改为 interfaceGroupApi.router    interfaceApi.router,  # 改为 interfaceApi.router    interfaceCase.router,  # 改为 interfaceCase.router    interfaceRecord.router,  # 改为 interfaceRecord.router    mockApi.router,  # 改为 mockApi.router    mockApi.public_mock_router  # 添加公共Mock路由器]